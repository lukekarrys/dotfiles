{{- if .is.Main -}}
#!/bin/bash

set -euo pipefail

{{ $fishBin := joinPath .dirs.brewBin "fish" }}
{{ $zshBin := joinPath .dirs.brewBin "zsh" }}
{{ $bashBin := joinPath .dirs.brewBin "bash" }}

if ! ggrep --fixed-strings "{{ $fishBin }}" /etc/shells ; then
  echo {{ $fishBin }} | sudo tee -a /etc/shells
fi

if ! ggrep --fixed-strings "{{ $zshBin }}" /etc/shells ; then
  echo {{ $zshBin }} | sudo tee -a /etc/shells
fi

if ! ggrep --fixed-strings "{{ $bashBin }}" /etc/shells ; then
  echo {{ $bashBin }} | sudo tee -a /etc/shells
fi

if [[ "$SHELL" != "{{ $fishBin }}" ]] ; then
  sudo chsh -s "{{ $fishBin }}" "{{ .chezmoi.username }}"
fi
{{- end -}}
